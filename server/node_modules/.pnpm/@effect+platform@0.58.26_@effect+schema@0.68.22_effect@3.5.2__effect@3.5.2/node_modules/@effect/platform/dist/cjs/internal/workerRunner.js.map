{"version":3,"file":"workerRunner.js","names":["Schema","_interopRequireWildcard","require","Serializable","Cause","Chunk","Context","Effect","Either","ExecutionStrategy","Exit","Fiber","_Function","Layer","Option","Queue","Scope","Stream","Transferable","_WorkerError","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","PlatformRunnerTypeId","exports","Symbol","for","PlatformRunner","GenericTag","make","process","options","gen","_","scope","fork","parallel","fiber","getOrThrow","getCurrentFiber","shutdown","zipRight","close","void","interruptFork","platform","backing","start","extend","fiberMap","Map","take","queue","decode","flatMap","msg","req","succeed","map","data","identity","tap","portId","id","interrupt","collector","unsafeMakeCollector","pipe","sync","stream","effect","isEffect","transfers","encodeOutput","provideService","Collector","payload","send","unsafeRead","chunks","undefined","toReadonlyArray","unsafeClear","forEach","option","push","orDie","transfer","runDrain","andThen","traceId","spanId","sampled","withParentSpan","_tag","context","empty","catchIf","isWorkerError","error","WorkerError","encodeCause","fail","catchAllCause","cause","match","failureOrCause","onLeft","encodeError","onRight","ensuring","delete","forever","forkIn","layer","scopedDiscard","makeSerialized","schema","handlers","parseRequest","decodeUnknown","request","result","isLayer","buildWithScope","merge","provide","provideContext","message","mapError","reason","serializeFailure","serializeSuccess","layerSerialized"],"sources":["../../../src/internal/workerRunner.ts"],"sourcesContent":[null],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,uBAAA,CAAAC,OAAA;AACA,IAAAC,YAAA,GAAAF,uBAAA,CAAAC,OAAA;AACA,IAAAE,KAAA,GAAAH,uBAAA,CAAAC,OAAA;AACA,IAAAG,KAAA,GAAAJ,uBAAA,CAAAC,OAAA;AACA,IAAAI,OAAA,GAAAL,uBAAA,CAAAC,OAAA;AACA,IAAAK,MAAA,GAAAN,uBAAA,CAAAC,OAAA;AACA,IAAAM,MAAA,GAAAP,uBAAA,CAAAC,OAAA;AACA,IAAAO,iBAAA,GAAAR,uBAAA,CAAAC,OAAA;AACA,IAAAQ,IAAA,GAAAT,uBAAA,CAAAC,OAAA;AACA,IAAAS,KAAA,GAAAV,uBAAA,CAAAC,OAAA;AACA,IAAAU,SAAA,GAAAV,OAAA;AACA,IAAAW,KAAA,GAAAZ,uBAAA,CAAAC,OAAA;AACA,IAAAY,MAAA,GAAAb,uBAAA,CAAAC,OAAA;AACA,IAAAa,KAAA,GAAAd,uBAAA,CAAAC,OAAA;AACA,IAAAc,KAAA,GAAAf,uBAAA,CAAAC,OAAA;AACA,IAAAe,MAAA,GAAAhB,uBAAA,CAAAC,OAAA;AACA,IAAAgB,YAAA,GAAAjB,uBAAA,CAAAC,OAAA;AAEA,IAAAiB,YAAA,GAAAjB,OAAA;AAA8D,SAAAkB,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAApB,wBAAAoB,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AAG9D;AACO,MAAMW,oBAAoB,GAAAC,OAAA,CAAAD,oBAAA,gBAAsCE,MAAM,CAACC,GAAG,CAC/E,wCAAwC,CACJ;AAEtC;AACO,MAAMC,cAAc,GAAAH,OAAA,CAAAG,cAAA,gBAAGtC,OAAO,CAACuC,UAAU,CAC9C,wCAAwC,CACzC;AAED;AACO,MAAMC,IAAI,GAAGA,CAClBC,OAAwE,EACxEC,OAA8C,KAE9CzC,MAAM,CAAC0C,GAAG,CAAC,WAAUC,CAAC;EACpB,MAAMC,KAAK,GAAG,OAAOD,CAAC,CAAClC,KAAK,CAACoC,IAAI,CAAC,OAAOF,CAAC,CAAC3C,MAAM,CAAC4C,KAAK,CAAC,EAAE1C,iBAAiB,CAAC4C,QAAQ,CAAC,CAAC;EACtF,MAAMC,KAAK,GAAGxC,MAAM,CAACyC,UAAU,CAAC5C,KAAK,CAAC6C,eAAe,EAAE,CAAC;EACxD,MAAMC,QAAQ,GAAGlD,MAAM,CAACmD,QAAQ,CAC9B1C,KAAK,CAAC2C,KAAK,CAACR,KAAK,EAAEzC,IAAI,CAACkD,IAAI,CAAC,EAC7BjD,KAAK,CAACkD,aAAa,CAACP,KAAK,CAAC,CAC3B;EACD,MAAMQ,QAAQ,GAAG,OAAOZ,CAAC,CAACN,cAAc,CAAC;EACzC,MAAMmB,OAAO,GAAG,OAAOb,CAAC,CACtBY,QAAQ,CAACE,KAAK,CAAsDP,QAAQ,CAAC,EAC7EzC,KAAK,CAACiD,MAAM,CAACd,KAAK,CAAC,CACpB;EACD,MAAMe,QAAQ,GAAG,IAAIC,GAAG,EAA6B;EAErD,OAAOjB,CAAC,CACNnC,KAAK,CAACqD,IAAI,CAACL,OAAO,CAACM,KAAK,CAAC,EACzBrB,OAAO,EAAEsB,MAAM,GACb/D,MAAM,CAACgE,OAAO,CAAEC,GAAG,IAAqF;IACtG,MAAMC,GAAG,GAAGD,GAAG,CAAC,CAAC,CAAC;IAClB,IAAIC,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE;MAChB,OAAOlE,MAAM,CAACmE,OAAO,CAACF,GAAG,CAAC;IAC5B;IAEA,OAAOjE,MAAM,CAACoE,GAAG,CAAC3B,OAAO,CAACsB,MAAO,CAACG,GAAG,CAAC,CAAC,CAAC,CAAC,EAAGG,IAAI,IAAK,CAACJ,GAAG,CAAC,CAAC,CAAC,EAAE,CAACC,GAAG,CAAC,CAAC,CAAC,EAAEA,GAAG,CAAC,CAAC,CAAC,EAAEG,IAAI,EAAEH,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EAChG,CAAC,CAAC,GACFI,kBAAQ,EACVtE,MAAM,CAACuE,GAAG,CAAC,CAAC,CAACC,MAAM,EAAEN,GAAG,CAAC,KAAI;IAC3B,MAAMO,EAAE,GAAGP,GAAG,CAAC,CAAC,CAAC;IACjB,IAAIA,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE;MAChB,MAAMnB,KAAK,GAAGY,QAAQ,CAACtC,GAAG,CAACoD,EAAE,CAAC;MAC9B,IAAI,CAAC1B,KAAK,EAAE,OAAO/C,MAAM,CAACqD,IAAI;MAC9B,OAAOjD,KAAK,CAACsE,SAAS,CAAC3B,KAAK,CAAC;IAC/B;IAEA,MAAM4B,SAAS,GAAGhE,YAAY,CAACiE,mBAAmB,EAAE;IACpD,OAAO,IAAAC,cAAI,EACT7E,MAAM,CAAC8E,IAAI,CAAC,MAAMtC,OAAO,CAAC0B,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,EAClClE,MAAM,CAACgE,OAAO,CAAEe,MAAM,IAAI;MACxB,IAAIC,MAAM,GAAGhF,MAAM,CAACiF,QAAQ,CAACF,MAAM,CAAC,GAClC/E,MAAM,CAACgE,OAAO,CAACe,MAAM,EAAGV,IAAI,IAAI;QAC9B,MAAMa,SAAS,GAAGzC,OAAO,EAAEyC,SAAS,GAAGzC,OAAO,CAACyC,SAAS,CAACb,IAAI,CAAC,GAAG,EAAE;QACnE,OAAO,IAAAQ,cAAI,EACTpC,OAAO,EAAE0C,YAAY,GACjBnF,MAAM,CAACoF,cAAc,CAAC3C,OAAO,CAAC0C,YAAY,CAACjB,GAAG,CAAC,CAAC,CAAC,EAAEG,IAAI,CAAC,EAAE1D,YAAY,CAAC0E,SAAS,EAAEV,SAAS,CAAC,GAC5F3E,MAAM,CAACmE,OAAO,CAACE,IAAI,CAAC,EACxBrE,MAAM,CAACgE,OAAO,CAAEsB,OAAO,IACrB9B,OAAO,CAAC+B,IAAI,CAACf,MAAM,EAAE,CAACC,EAAE,EAAE,CAAC,EAAE,CAACa,OAAO,CAAC,CAAC,EAAE,CACvC,GAAGJ,SAAS,EACZ,GAAGP,SAAS,CAACa,UAAU,EAAE,CAC1B,CAAC,CACH,CACF;MACH,CAAC,CAAC,GACF,IAAAX,cAAI,EACFE,MAAM,EACNrE,MAAM,CAAC+E,MAAM,EACb/E,MAAM,CAAC6D,GAAG,CAAEF,IAAI,IAAI;QAClB,IAAI5B,OAAO,EAAE0C,YAAY,KAAKO,SAAS,EAAE;UACvC,MAAMJ,OAAO,GAAGxF,KAAK,CAAC6F,eAAe,CAACtB,IAAI,CAAC;UAC3C,MAAMa,SAAS,GAAGzC,OAAO,EAAEyC,SAAS,GAAGI,OAAO,CAACtB,OAAO,CAACvB,OAAO,CAACyC,SAAS,CAAC,GAAGQ,SAAS;UACrF,OAAOlC,OAAO,CAAC+B,IAAI,CAACf,MAAM,EAAE,CAACC,EAAE,EAAE,CAAC,EAAEa,OAAO,CAAC,EAAEJ,SAAS,CAAC;QAC1D;QAEA,MAAMA,SAAS,GAAmB,EAAE;QACpCP,SAAS,CAACiB,WAAW,EAAE;QACvB,OAAO,IAAAf,cAAI,EACT7E,MAAM,CAAC6F,OAAO,CAACxB,IAAI,EAAGA,IAAI,IAAI;UAC5B,IAAI5B,OAAO,EAAEyC,SAAS,EAAE;YACtB,KAAK,MAAMY,MAAM,IAAIrD,OAAO,CAACyC,SAAS,CAACb,IAAI,CAAC,EAAE;cAC5Ca,SAAS,CAACa,IAAI,CAACD,MAAM,CAAC;YACxB;UACF;UACA,OAAO9F,MAAM,CAACgG,KAAK,CAACvD,OAAO,CAAC0C,YAAa,CAACjB,GAAG,CAAC,CAAC,CAAC,EAAEG,IAAI,CAAC,CAAC;QAC1D,CAAC,CAAC,EACFrE,MAAM,CAACoF,cAAc,CAACzE,YAAY,CAAC0E,SAAS,EAAEV,SAAS,CAAC,EACxD3E,MAAM,CAACgE,OAAO,CAAEsB,OAAO,IAAI;UACzBX,SAAS,CAACa,UAAU,EAAE,CAACK,OAAO,CAAEI,QAAQ,IAAKf,SAAS,CAACa,IAAI,CAACE,QAAQ,CAAC,CAAC;UACtE,OAAOzC,OAAO,CAAC+B,IAAI,CAACf,MAAM,EAAE,CAACC,EAAE,EAAE,CAAC,EAAEa,OAAO,CAAC,EAAEJ,SAAS,CAAC;QAC1D,CAAC,CAAC,CACH;MACH,CAAC,CAAC,EACFxE,MAAM,CAACwF,QAAQ,EACflG,MAAM,CAACmG,OAAO,CAAC3C,OAAO,CAAC+B,IAAI,CAACf,MAAM,EAAE,CAACC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAC9C;MAEH,IAAIP,GAAG,CAAC,CAAC,CAAC,EAAE;QACV,MAAM,CAACkC,OAAO,EAAEC,MAAM,EAAEC,OAAO,CAAC,GAAGpC,GAAG,CAAC,CAAC,CAAC;QACzCc,MAAM,GAAGhF,MAAM,CAACuG,cAAc,CAACvB,MAAM,EAAE;UACrCwB,IAAI,EAAE,cAAc;UACpBJ,OAAO;UACPC,MAAM;UACNC,OAAO;UACPG,OAAO,EAAE1G,OAAO,CAAC2G,KAAK;SACvB,CAAC;MACJ;MAEA,OAAO1B,MAAM;IACf,CAAC,CAAC,EACFhF,MAAM,CAAC2G,OAAO,CAACC,0BAAa,EAAGC,KAAK,IAClCrD,OAAO,CAAC+B,IAAI,CAACf,MAAM,EAAE,CAACC,EAAE,EAAE,CAAC,EAAEqC,wBAAW,CAACC,WAAW,CAAClH,KAAK,CAACmH,IAAI,CAACH,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,EAC5E7G,MAAM,CAACiH,aAAa,CAAEC,KAAK,IACzBjH,MAAM,CAACkH,KAAK,CAACtH,KAAK,CAACuH,cAAc,CAACF,KAAK,CAAC,EAAE;MACxCG,MAAM,EAAGR,KAAK,IAAI;QAChB,MAAM3B,SAAS,GAAGzC,OAAO,EAAEyC,SAAS,GAAGzC,OAAO,CAACyC,SAAS,CAAC2B,KAAK,CAAC,GAAG,EAAE;QACpElC,SAAS,CAACiB,WAAW,EAAE;QACvB,OAAO,IAAAf,cAAI,EACTpC,OAAO,EAAE6E,WAAW,GAChBtH,MAAM,CAACoF,cAAc,CACrB3C,OAAO,CAAC6E,WAAW,CAACpD,GAAG,CAAC,CAAC,CAAC,EAAE2C,KAAK,CAAC,EAClClG,YAAY,CAAC0E,SAAS,EACtBV,SAAS,CACV,GACC3E,MAAM,CAACmE,OAAO,CAAC0C,KAAK,CAAC,EACzB7G,MAAM,CAACgE,OAAO,CAAEsB,OAAO,IACrB9B,OAAO,CAAC+B,IAAI,CAACf,MAAM,EAAE,CAACC,EAAE,EAAE,CAAC,EAAEa,OAAc,CAAC,EAAE,CAC5C,GAAGJ,SAAS,EACZ,GAAGP,SAAS,CAACa,UAAU,EAAE,CAC1B,CAAC,CACH,EACDxF,MAAM,CAACiH,aAAa,CAAEC,KAAK,IACzB1D,OAAO,CAAC+B,IAAI,CAACf,MAAM,EAAE,CAACC,EAAE,EAAE,CAAC,EAAEqC,wBAAW,CAACC,WAAW,CAACG,KAAK,CAAC,CAAC,CAAC,CAC9D,CACF;MACH,CAAC;MACDK,OAAO,EAAGL,KAAK,IAAK1D,OAAO,CAAC+B,IAAI,CAACf,MAAM,EAAE,CAACC,EAAE,EAAE,CAAC,EAAEqC,wBAAW,CAACC,WAAW,CAACG,KAAK,CAAC,CAAC;KACjF,CAAC,CACH,EACDlH,MAAM,CAACwH,QAAQ,CAACxH,MAAM,CAAC8E,IAAI,CAAC,MAAMnB,QAAQ,CAAC8D,MAAM,CAAChD,EAAE,CAAC,CAAC,CAAC,EACvDzE,MAAM,CAAC6C,IAAI,EACX7C,MAAM,CAACuE,GAAG,CAAExB,KAAK,IAAK/C,MAAM,CAAC8E,IAAI,CAAC,MAAMnB,QAAQ,CAAC3B,GAAG,CAACyC,EAAE,EAAE1B,KAAK,CAAC,CAAC,CAAC,CAClE;EACH,CAAC,CAAC,EACF/C,MAAM,CAAC0H,OAAO,EACd1H,MAAM,CAAC2H,MAAM,CAAC/E,KAAK,CAAC,CACrB;AACH,CAAC,CAAC;AAEJ;AAAAV,OAAA,CAAAK,IAAA,GAAAA,IAAA;AACO,MAAMqF,KAAK,GAAGA,CACnBpF,OAAwE,EACxEC,OAA8C,KACuBnC,KAAK,CAACuH,aAAa,CAACtF,IAAI,CAACC,OAAO,EAAEC,OAAO,CAAC,CAAC;AAElH;AAAAP,OAAA,CAAA0F,KAAA,GAAAA,KAAA;AACO,MAAME,cAAc,GAAGA,CAM5BC,MAA8B,EAC9BC,QAAkB,KASlBhI,MAAM,CAAC0C,GAAG,CAAC,WAAUC,CAAC;EACpB,MAAMC,KAAK,GAAG,OAAOD,CAAC,CAAC3C,MAAM,CAAC4C,KAAK,CAAC;EACpC,IAAI6D,OAAO,GAAG1G,OAAO,CAAC2G,KAAK,EAA0B;EACrD,MAAMuB,YAAY,GAAGxI,MAAM,CAACyI,aAAa,CAACH,MAAM,CAAqC;EAErF,OAAO,OAAOpF,CAAC,CAACJ,IAAI,CAAE4F,OAAU,IAAI;IAClC,MAAMC,MAAM,GAAIJ,QAAgB,CAACG,OAAO,CAAC3B,IAAI,CAAC,CAAC2B,OAAO,CAAC;IACvD,IAAI7H,KAAK,CAAC+H,OAAO,CAACD,MAAM,CAAC,EAAE;MACzB,OAAOpI,MAAM,CAACgE,OAAO,CAAC1D,KAAK,CAACgI,cAAc,CAACF,MAAM,EAAExF,KAAK,CAAC,EAAGD,CAAC,IAC3D3C,MAAM,CAAC8E,IAAI,CAAC,MAAK;QACf2B,OAAO,GAAG1G,OAAO,CAACwI,KAAK,CAAC9B,OAAO,EAAE9D,CAAC,CAAC;MACrC,CAAC,CAAC,CAAC;IACP,CAAC,MAAM,IAAI3C,MAAM,CAACiF,QAAQ,CAACmD,MAAM,CAAC,EAAE;MAClC,OAAOpI,MAAM,CAACwI,OAAO,CAACJ,MAAM,EAAE3B,OAAO,CAAC;IACxC;IACA,OAAO/F,MAAM,CAAC+H,cAAc,CAACL,MAAa,EAAE3B,OAAO,CAAC;EACtD,CAAC,EAAE;IACD1C,MAAMA,CAAC2E,OAAO;MACZ,OAAO1I,MAAM,CAAC2I,QAAQ,CACpBV,YAAY,CAACS,OAAO,CAAC,EACpB7B,KAAK,IAAK,IAAIC,wBAAW,CAAC;QAAE8B,MAAM,EAAE,QAAQ;QAAE/B;MAAK,CAAE,CAAC,CACxD;IACH,CAAC;IACDS,WAAWA,CAACa,OAAO,EAAEO,OAAO;MAC1B,OAAO1I,MAAM,CAAC2I,QAAQ,CACpB/I,YAAY,CAACiJ,gBAAgB,CAACV,OAAc,EAAEO,OAAO,CAAC,EACrD7B,KAAK,IAAK,IAAIC,wBAAW,CAAC;QAAE8B,MAAM,EAAE,QAAQ;QAAE/B;MAAK,CAAE,CAAC,CACxD;IACH,CAAC;IACD1B,YAAYA,CAACgD,OAAO,EAAEO,OAAO;MAC3B,OAAO1I,MAAM,CAACiH,aAAa,CACzBrH,YAAY,CAACkJ,gBAAgB,CAACX,OAAc,EAAEO,OAAO,CAAC,EACrD7B,KAAK,IAAK,IAAIC,wBAAW,CAAC;QAAE8B,MAAM,EAAE,QAAQ;QAAE/B;MAAK,CAAE,CAAC,CACxD;IACH;GACD,CAAC,CAAC;AACL,CAAC,CAAQ;AAEX;AAAA3E,OAAA,CAAA4F,cAAA,GAAAA,cAAA;AACO,MAAMiB,eAAe,GAAGA,CAM7BhB,MAA8B,EAC9BC,QAAkB,KAOf1H,KAAK,CAACuH,aAAa,CAACC,cAAc,CAACC,MAAM,EAAEC,QAAQ,CAAC,CAAC;AAAA9F,OAAA,CAAA6G,eAAA,GAAAA,eAAA","ignoreList":[]}